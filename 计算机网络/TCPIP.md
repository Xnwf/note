### 计算机网络

1. 组成部分:软件/硬件/协议

2. 工作方式:
   + 边缘部分(用户)
     + C/S
     + P2P
   + 核心部分
   
3. 功能组成:
   + 通信子网 实现数据通信
   + 资源子网 实现数据共享/数据处理
   
   
   
4. 分层基本原则

   + 各层独立,只实现一种相对独立的功能
   + 每层之间界面自然清洗
   + 结构上可分割开,每层采用最合适的技术
   + 保持下层对上层的独立性,上层单向使用下层的服务
   + 分层结构促进标准化工作
   
5. 实体、协议、接口、服务
   + 实体:第n层中活动的元素称为n层实体,同一层的实体叫对等实体
   + 协议:为进行网络中的对等实体数据交换而建立的规则、标准和约定称为网络协议
   + 接口:上层使用下层服务的入口
   + 服务:下层为上层提供功能的调用

   #### OSI`参考模型 (七层)`

   *物联网淑惠试用*

   <img src="C:\Users\HerMajesty\AppData\Roaming\Typora\typora-user-images\image-20200907200101396.png" alt="image-20200907200101396" style="zoom:67%;" />
   
   + 资源子网`实现资源共享功能的设备和软件的集合`
  1. **应用层**`能和用户交互产生网络流量的程序`
     2. 表示层`用于处理再两个通信系统中交换信息的表示方式(语法和语义)`
     
     + 数据格式变换
     + 数据加密和解密
  + 数据压缩和恢复
     3. 会话层`想表示层实体/用户进程提供连接并在连接上有序地传输数据,就是建立同步(SYN)`

     + 建立、管理、终止会话
     
     + 使用校验点可以使会话在通信失效事从校验点/同步点继续恢复通信,实现数据同步
     + `ADSP/ASP协议`
     
      + **4. 传输层**`负责主机中两个进程的通信,即端到端的通信.传输单位是报文段或数据用户报 + 上下子网的接口
     
         + 可靠传输(TCP)/不可靠传输(UDP)
         + 差错控制
         + 流量控制
         + 复用分用
           + 复用:多个应用的进程可同时使用下面运输层的服务
        + 分用:运输层把收到的信息分别交付给上面应用层中相应的进程
         + `TCP/UDP协议`  

   + 通信子网`各种传输介质/通信设备/相应的网络协议`
   
     5. 网络层 `路由器 主要任务是吧分组从源端传到目的端,为分组交换网上的不同主机提供通信服务,网络层传输单位是数据报`   
           + 路由选择(最佳路径)
           + 流量控制
	        + 查错控制(奇偶校验等)
	        + 拥塞控制
             		+ `IP IPX ICMP IGMP ARP RARP OSPF 协议`
   6. 数据链路层 `交换机 把网络层传下来的数据报组装成帧`
         +  数据链路层的传输单位是帧  
      +  成帧(定义帧的开始和结束)
      +  查错控制(帧错+位错)
	   +  流量控制
      +  访问(接入)控制 控制对信道的访问 
   7. 物理层 `集线器,中继器 物理媒体上实现比特流的透明传输`
         + 物理层传输单位是比特
      + 不管所传的数据是什么样的比特组合,都应当能够在链路上传输
      + 定义接口特性
      + 定义传输模式
         + 单工:只允许一方发送,另一方接受
         + 半双工:双方都可以接受或发送,但同一时间只能有只能保持一个状态
         + 双工::双方都可以接受或发送,同一时间可以双向发送或接受
      + 定义传输速率
      + 比特同步
      + 比特编码
      + `RJ45,802.3协议`

   

   #### `TCP/IP`事实模型(四层)

![image-20200907203943539](C:\Users\HerMajesty\AppData\Roaming\Typora\typora-user-images\image-20200907203943539.png)

|        | OSI  | TCP/IP |
| :----: | :--: | :----: |
| 网络层 | 无连接+面向连接     |    无连接    |
| 传输层 | 面向连接 | 无连接+面向连接 |



#### 传输层

> 为应用层提供通信服务,使用网络层的服务

##### 功能

1. 提供进程与进程之间的逻辑通讯

2. 复用和分用

   1. 复用:应用层所有的应用进程都可以通过传输层再传输到网络层

   2. 分用:传输层从网络层收到数据后交付指明的应用进程

      + 确定应用的方式是端口号

        + 长度为16bit 能表示65536个不同的端口

        + 端口号分为 

          + 服务端使用的端口号

            + 熟知端口号(0-1023) 给TCP/IP中最重要的一些应用程序

            ![image-20200907211400901](C:\Users\HerMajesty\AppData\Roaming\Typora\typora-user-images\image-20200907211400901.png)

            + 等级端口号(1024-49151) 为其他使用

          + 客户端使用的端口号(49152-65535)仅仅在客户进程运行时才动态选择

3. 传输层对收到的报文进行查错检验

#### 套接字Socket

套接字可以标识网络中唯一主机中的一个应用

`Socket = (主机IP地址,端口号)`



##### UDP

> > 无连接的用户数据报协议UDP

1. 概述

   传送数据之前不需要建立连接,收到UDP报文后也不需要给出任何确认

   UDP只在IP数据报服务之上添加了很少的功能,即复用分用和差错检测功能

2. 特点

   + UDP是无连接的,减少开销和发送数据之前的时延
   + UDP使用最大努力交付,即不保证可靠交付
   + UDP是面向豹纹的,适合一次传输少量数据的网络应用(应用层给多大的报文,UDP就发多大的给网络层)
   + UDP无拥塞控制,适合实时应用
   + UDP首部开销小,8Byte,TCP有20Byte

   ![image-20200907212116702](C:\Users\HerMajesty\AppData\Roaming\Typora\typora-user-images\image-20200907212116702.png)

##### TCP

> > 面向连接的传输控制协议

1. 概述

   传送数据之前必须建立连接,数据传送结束后要释放连接,不提供广播或多播服务.由于TCP要提供可靠的面向连接的传输服务,因此不可避免的增加了许多开销:确认,流量控制,计时器,连接管理等

2. 特点

   1. TCP是面向连接的传输层协议
   2. 每一条TCP连接只能有两个端点,每一条TCP连接只能是点对点的
   3. TCP提供可靠交付的服务,无差错,不丢失,不重复,按序到达
   4. TCP可提供全双工
   5. TCP面向字节流

3. TCP报文段首部格式

   1. 源端口和目的端口 每个都是16Byte
   2. 序号:在TCP连接中传送的字节流中的每一个字节都按顺序编号,本字段表示本报文段所发送数据的第一个字节的序号
   3. 确认号:期望收到对方下一个报文段的第一个数据字节的序号,若确认号为N,则证明序号N-1位置所有的额数据都已经正确收到
   4. 数据偏移(首部长度):TCP报文段的数据起始位置距离TCP报文段的起始位置有多远,以4B为单位
   5. 六个控制位:
      + **紧急位**`URG`:为1时表明该报文有紧急数据,高优先级数据,不用再缓存中排队,需要尽快传送
      + **确认位**`ACk`:为1时确认号有效,在连接建立后所有传送的报文段都必须把`ACK`设置成1
      + 推送位`PSH`:为1时,在接受端要优先交付给进程,不必等到缓存填满再交付
      + 复位`RST`:为1时,表明TCP连接中出现严重差错,必须释放连接,重新建立连接
      + **同步位**`SYN`:为1时,表明连接请求/接受连接报文
      + **终止位**`FIN`: 为1时,表明此报文段发送方数据已经发送完毕,要求释放
   6. 窗口:指发送报文段的一方的接受窗口,即现在允许对方发送的数据量
   7. 检验和:件验首部+数据,检验时要加上12B伪首部,第四个字段为6
   8. 紧急指针:URG=1时有意义,指出本报文段中紧急数据的字节数
   9. 选项:最大报文段长度MSS/窗口扩大/时间戳/确认选择
   10. 填充:使得TCP首部长度为4byte的整数倍

![image-20200907212930237](C:\Users\HerMajesty\AppData\Roaming\Typora\typora-user-images\image-20200907212930237.png)

4. TCP连接管理

   > 连接建立 - 数据传送 - 连接释放
   >
   > 采用客户服务器方式,主动发起连接建立的应用进程叫客户,而被动等待连接建立的应用进程叫服务器

   **三次握手(连接)**

   ![image-20200907220651734](C:\Users\HerMajesty\AppData\Roaming\Typora\typora-user-images\image-20200907220651734.png)

   1. 客户端发送**连接请求报文**,无应用层数据 

      `SYN = 1 , seq = x(随机) ACK = 0`

   2. 服务端为该TCP连接**分配缓存和变量**,并向客户端**返回确认报文段**,允许连接,无应用数据

      `SYN = 1,ACK = 1(确认位),seq = y,ack = x+1(确认号)` 

   3. 客户端为该TCP连接**分配缓存和变量**,并向服务端**返回确认的确认,可以携带数据**

      `SYN = 0(同步位),ACK = 1,seq = x+1,ack = y+1`

   **四次握手(释放)**

   1. 客服端发送连接释放报文段,停止发送数据,主动关闭TCP

      `FIN=1,seq=u`

   2. 服务器确认报文段,客户到服务器这个方向的连接释放

      `ACK = 1 ,seq =v, ack = u+1`

   3. 服务器端发完数据,就发出连接释放报文段,主动关闭TCP

      `FIN=1 ,ACK=1,seq=w,ack=u+1`

   4. 客户端回复确认报文段,再等到时间等待计时器设置的2MSL(最长报文段寿命)后彻底关闭

      `ACK=1,seq=u+1,ack=w+1`

